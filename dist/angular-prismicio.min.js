/**
 * AngularJS service for prismic.io
 * @version v0.1.0 - 2014-06-03
 * @link 
 * @author Arjan Wulder <arjanwulder@gmail.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
"use strict";angular.module("prismic.io",[]).provider("Prismic",function(){var a={};a.init=function(a,b){a.configuration=b,b.apiEndpoint=angular.isUndefined(b.apiEndpoint)?"":b.apiEndpoint,a.setApiEndpoint=function(a){b.apiEndpoint=a},b.accessToken=angular.isUndefined(b.accessToken)?"":b.accessToken,a.setAccessToken=function(a){b.accessToken=a},b.clientId=angular.isUndefined(b.clientId)?"":b.clientId,a.setClientId=function(a){b.clientId=a},b.clientSecret=angular.isUndefined(b.clientSecret)?"":b.clientSecret,a.setClientSecret=function(a){b.clientSecret=a},b.linkResolver=angular.isUndefined(b.linkResolver)?function(){}:b.linkResolver,a.setLinkResolver=function(a){b.linkResolver=a}};var b={};a.init(this,b),this.$get=["$window","$http","$q",function(c,d,e){function f(b){function f(a,b){d.get(a).then(function(a){b(null,a.data)},function(a){b(a,null)})}function g(a){u.Api(b.apiEndpoint,a,b.accessToken,f)}function h(a,c){g(function(d,e){e?(s={ref:a||e.data.master.ref,api:e,maybeRef:a&&a!==e.data.master.ref?a:"",maybeRefParam:a&&a!==e.data.master.ref?"&ref="+a:"",oauth:function(){return{accessToken:b.accessToken,hasPrivilegedAccess:!!b.accessToken}},linkResolver:b.linkResolver},c(null,s)):c(d,null)})}function i(a){s?a(null,s):h(v.ref,function(b,c){a(b,c)})}function j(a){for(var b,c={},d=/\+/g,e=/([^&=]+)=?([^&]*)/g,f=function(a){return decodeURIComponent(a.replace(d," "))};b=e.exec(a);)c[f(b[1])]=f(b[2]);return c}function k(){var a=e.defer();return i(function(b,c){c?a.resolve(c.api):a.reject(b)}),a.promise}function l(){var a=e.defer();return i(function(b,c){c?a.resolve(c):a.reject(b)}),a.promise}function m(){var a=e.defer();return i(function(b,c){c?c.api.form("everything").ref(c.ref).submit(function(b,c){a.resolve(c)}):a.reject(b)}),a.promise}function n(a){var b=e.defer();return i(function(c,d){d.api.forms("everything").ref(d.ref).query(a).submit(function(a,c){b.resolve(c)})}),b.promise}function o(a){var b=e.defer();return i(function(c,d){d?d.api.form("everything").ref(d.ref).query('[[:d = at(document.type, "'+a+'")]]').submit(function(a,c){c?b.resolve(c):b.reject(a)}):b.reject(c)}),b.promise}function p(a){var b=e.defer();return i(function(c,d){d?d.api.form("everything").ref(d.ref).query('[[:d = at(document.id, "'+a+'")]]').submit(function(a,c){c?b.resolve(c.results[0]):b.reject(a)}):b.reject(c)}),b.promise}function q(a){var b=e.defer();return a&&a.length&&i(function(c,d){d?d.api.form("everything").ref(d.ref).query("[[:d = any(document.id, ["+a.map(function(a){return'"'+a+'"'}).join(",")+"])]]").submit(function(a){b.resolve(a)}):b.reject(c)}),b.promise}function r(a){var b;i(function(c,d){return c?(b=c.api.bookmarks[a],b?p(b):e.promise):void e.reject(d)})}var s,t={},u=c.Prismic,v=j(c.location.search.substring(1));return a.init(t,b),t.api=k,t.ctx=l,t.all=m,t.query=n,t.documentTypes=o,t.document=p,t.documents=q,t.bookmark=r,t}return f(b)}]}).directive("prismicHtml",["$window","Prismic",function(a,b){return{restrict:"E",scope:{fragment:"=fragment"},link:function(c,d){c.$watch("fragment",function(){if(c.fragment){var e=a.Prismic.Fragments.initField(c.fragment);if(e){var f=e.asHtml(b.configuration);d[0].innerHTML=f}}})}}}]);